<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <title>Buscador de Ejercicios de F√≠sica</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      padding: 2em;
      background-color: #f9f9f9;
      color: #333;
      margin: 0;
    }

    h1 {
      text-align: center;
      margin-bottom: 1em;
      color: #2c3e50;
    }

    .filtros {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 1em;
      margin-bottom: 1.5em;
    }

    label {
      font-weight: bold;
      margin-bottom: 0.25em;
      display: block;
    }

    select,
    input {
      width: 100%;
      padding: 0.4em;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    button {
      padding: 0.6em 1.2em;
      margin-top: 1em;
      background-color: #3498db;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    button:hover {
      background-color: #2980b9;
    }

    .resultado {
      margin-top: 2em;
    }

    .item {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      padding: 1em;
      margin-bottom: 2em;
    }

    iframe {
      width: 100%;
      height: 300px;
      border: none;
      border-top: 1px solid #ccc;
      margin-top: 1em;
    }

    @media (max-width: 600px) {
      iframe {
        height: 200px;
      }
    }
  </style>
</head>

<body>
  <h1>Buscador de Ejercicios de F√≠sica</h1>

  <div class="filtros">
    <div>
      <label for="palabraClave">Palabra clave:</label>
      <input type="text" id="palabraClave" />
    </div>

    <div>
      <label for="tipo">Tipo:</label>
      <select id="tipo">
        <option value="">(cualquiera)</option>
        <option value="Planificaci√≥n">Planificaci√≥n</option>
        <option value="Gu√≠a">Gu√≠a</option>
        <option value="Ejercicios">Ejercicios</option>
      </select>
    </div>

    <div>
      <label for="nivel">Nivel:</label>
      <select id="nivel">
        <option value="">(cualquiera)</option>
        <option value="1¬∞ medio">1¬∞ medio</option>
        <option value="2¬∞ medio">2¬∞ medio</option>
        <option value="2¬∞ medio">3¬∞ medio</option>
        <option value="2¬∞ medio">4¬∞ medio</option>
        <option value="Electivo">Electivo</option>
        <option value="PAES">PAES</option>
      </select>
    </div>

    <div>
      <label for="tema">Tema:</label>
      <select id="tema">
        <option value="">(cualquiera)</option>
        <option value="Fuerza">Fuerza</option>
        <option value="Luz">Luz</option>
        <option value="MRU">MRU</option>
        <option value="MRUA">MRUA</option>
        <option value="M√©todo Cient√≠fico">M√©todo Cient√≠fico</option>
        <option value="Ondas">Ondas</option>
        <option value="Sonido">Sonido</option>
      </select>
    </div>

    <div>
      <label for="tipoEjercicio">Tipo de ejercicio:</label>
      <select id="tipoEjercicio">
        <option value="">(cualquiera)</option>
        <option value="Alternativas">Alternativas</option>
        <option value="Desarrollo">Desarrollo</option>
      </select>
    </div>

    <div>
      <label for="dificultad">Dificultad:</label>
      <select id="dificultad">
        <option value="">(cualquiera)</option>
        <option value="Elemental">Elemental</option>
        <option value="Medio">Medio</option>
        <option value="Avanzado">Avanzado</option>
      </select>
    </div>
  </div>

  <div style="text-align:center;">
    <button onclick="filtrarEjercicios()">üîç Buscar ejercicios</button>
  </div>

  <div id="resultados" class="resultado"></div>

  <script>
    const SHEET_ID = "1TpgF0ME-GmgpD8akfvhfezKlQ6aB3NHvWzuXozVLElU";
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    let ejercicios = [];

    async function cargarEjerciciosDesdeSheet() {
      try {
        const response = await fetch(url);
        const text = await response.text();
        const json = JSON.parse(text.substr(47).slice(0, -2));
        const rows = json.table.rows;

        ejercicios = rows.map(row => {
          const c = row.c;
          return {
            titulo: c[0]?.v || '',
            tipo: c[1]?.v || '',
            nivel: c[2]?.v || '',
            tema: c[3]?.v || '',
            tipoEjercicio: c[4]?.v || '',
            dificultad: c[5]?.v || '',
            id: c[6]?.v || ''
          };
        });
      } catch (error) {
        console.error("Error cargando datos desde Google Sheets:", error);
        document.getElementById("resultados").innerHTML = "<p>Error al cargar los datos.</p>";
      }
    }

    function splitAndMatch(cellValue, filterValue) {
      return filterValue === "" || (cellValue && cellValue.split(",").map(s => s.trim()).includes(filterValue));
    }

    function filtrarEjercicios() {
      const palabraClave = document.getElementById("palabraClave").value.toLowerCase();
      const tipo = document.getElementById("tipo").value;
      const nivel = document.getElementById("nivel").value;
      const tema = document.getElementById("tema").value;
      const tipoEjercicio = document.getElementById("tipoEjercicio").value;
      const dificultad = document.getElementById("dificultad").value;

      const filtrados = ejercicios.filter(ej =>
        (palabraClave === "" || ej.titulo.toLowerCase().includes(palabraClave)) &&
        (tipo === "" || ej.tipo === tipo) &&
        splitAndMatch(ej.nivel, nivel) &&
        splitAndMatch(ej.tema, tema) &&
        (tipoEjercicio === "" || ej.tipoEjercicio === tipoEjercicio) &&
        (dificultad === "" || ej.dificultad === dificultad)
      );

      mostrarResultados(filtrados);
    }

    function mostrarResultados(lista) {
      const contenedor = document.getElementById("resultados");
      contenedor.innerHTML = "";

      if (lista.length === 0) {
        contenedor.innerHTML = "<p>No se encontraron resultados.</p>";
        return;
      }

      lista.forEach(ej => {
        const div = document.createElement("div");
        div.className = "item";
        div.innerHTML = `
          <strong>${ej.titulo}</strong><br>
          <small>Tipo: ${ej.tipo} | Nivel: ${ej.nivel} | Tema: ${ej.tema} | Tipo Ejercicio: ${ej.tipoEjercicio} | Dificultad: ${ej.dificultad}</small>
          ${ej.id ? `<iframe src="https://docs.google.com/document/d/${ej.id}/preview"></iframe>` : ''}
        `;
        contenedor.appendChild(div);
      });
    }

    window.onload = async () => {
      await cargarEjerciciosDesdeSheet();
    };
  </script>
</body>

</html>